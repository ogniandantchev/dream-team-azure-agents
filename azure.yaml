# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: dreamteam-simplified
metadata:
    template: dream-team-azure-agents-simplified@1.0.0
    description: "Simplified Dream Team Azure Agents using Microsoft Agent Framework, Streamlit, and Pulumi"
workflows:
  up: 
    steps:
      - azd: provision
      - azd: deploy --all
services:
    backend:
        project: backend_new
        host: containerapp
        language: python
        docker:
            path: Dockerfile
        hooks:
          postdeploy: 
            windows:
                shell: pwsh
                run: 'azd env get-values > .env'
            posix:
                shell: sh
                run: 'azd env get-values > .env'
    frontend:
        project: frontend_streamlit
        host: staticwebapp
        language: python
        hooks:
            prebuild:
                windows:
                    shell: pwsh
                    run: 'pip install -r requirements.txt; echo "BACKEND_URL=$env:BACKEND_URL" > .env'
                posix:
                    shell: sh
                    run: 'pip install -r requirements.txt && echo BACKEND_URL=\"$BACKEND_URL\" > .env'     
            postdeploy:
                windows:
                    shell: pwsh
                    run: 'echo "Streamlit frontend deployed successfully!"'
                posix:
                    shell: sh
                    run: 'echo "Streamlit frontend deployed successfully!"'